<div *ngIf="!loading && player" class="container mt-4">
    <div class="row">
      <!-- Player Info Card -->
      <div class="col-md-5">
        <div class="card shadow">
          <div class="card-body">
            <h5 class="card-title">{{ player.callName }}</h5>
            <p><strong>Name:</strong> {{ player.firstName }} {{ player.lastName }}</p>
            <p><strong>Gender:</strong> {{ player.gender }}</p>
            <p><strong>Position:</strong> {{ player.position }}</p>
            <p><strong>Archetype:</strong> {{ player.archetype }}</p>
            <p><strong>Number:</strong> {{ player.jerseyNumber }}</p>
            <p><strong>Handedness:</strong> {{ player.handedness }}</p>
            <p><strong>Height:</strong> {{ player.height }}</p>
            <p><strong>Weight:</strong> {{ player.weight }}</p>
            <p><strong>Fighting Tendency:</strong> {{ player.fightTendency }}</p>
            <p><strong>Origin:</strong> {{ player.origin }}</p>
            <p><strong>Race:</strong> {{ player.race }}</p>
            <p><strong>Hair:</strong> {{ player.hair }}</p>
            <p><strong>Beard:</strong> {{ player.beard }}</p>
            <p><strong>Stick Tape:</strong> {{ player.stickTapeColor }}</p>
            <p><strong>Twitch:</strong> {{ player.twitch }}</p>
            <p><strong>Referral:</strong> {{ player.referralSource }}</p>
            <p><strong>Invited By:</strong> {{ player.invitedBy }}</p>
            <p><strong>Age:</strong> {{ player.age }}</p>
            <p><strong>Team:</strong> {{ teamName || 'None' }}</p>
          </div>
        </div>
      </div>
  
      <!-- Training Section -->
      <div class="col-md-7">
        <div class="card shadow">
          <div class="card-body">
            <h5 class="card-title">Weekly Training</h5>
  
            <div *ngIf="trainingSubmitted; else trainingForm">
              <p><strong>Submitted Training:</strong> {{ trainingType }}</p>
              <p><strong>Status:</strong> {{ trainingStatus }}</p>
              <button class="btn btn-warning" (click)="trainingSubmitted = false">Edit</button>
            </div>
  
            <ng-template #trainingForm>
              <label for="trainingSelect">Select Training</label>
              <select class="form-select mb-3" [(ngModel)]="tempTrainingType" name="training" (change)="onTrainingChange()">
                <option value="">-- Select Training --</option>
                <option *ngFor="let option of trainingOptions" [value]="option">{{ option }}</option>
              </select>
              <button class="btn btn-primary" (click)="submitTraining()">Submit</button>
            </ng-template>
  
            <div *ngIf="trainingType === 'Learn Secondary Position'">
              <p class="mt-3 text-info">Progress toward secondary position: {{ secondaryProgress }}/3</p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Player Attributes Section -->
    <div class="row mt-4">
      <div class="col-12">
        <div class="card shadow">
          <div class="card-body">
            <h5 class="card-title">Player Attributes</h5>
            
            <!-- Skater Attributes -->
            <div *ngIf="player.position !== 'G'" class="table-responsive">
              <table class="table table-bordered table-sm">
                <thead class="table-light">
                  <tr>
                    <th *ngFor="let attr of skaterAttributeOrder">{{ attr }}</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td *ngFor="let attr of skaterAttributeOrder" 
                        [ngClass]="{ 'table-success': isAttributeAffected(attr) }">
                      <div class="d-flex justify-content-between align-items-center">
                        <span>{{ playerAttributes[attr] || 0 }}</span>
                        <span *ngIf="isAttributeAffected(attr)" class="text-success fw-bold">
                          +{{ getAttributeDelta() }}
                        </span>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>

            <!-- Goalie Attributes -->
            <div *ngIf="player.position === 'G'" class="table-responsive">
              <table class="table table-bordered table-sm">
                <thead class="table-light">
                  <tr>
                    <th *ngFor="let attr of goalieAttributeOrder">{{ attr }}</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td *ngFor="let attr of goalieAttributeOrder"
                        [ngClass]="{ 'table-success': isAttributeAffected(attr) }">
                      <div class="d-flex justify-content-between align-items-center">
                        <span>{{ playerAttributes[attr] || 0 }}</span>
                        <span *ngIf="isAttributeAffected(attr)" class="text-success fw-bold">
                          +{{ getAttributeDelta() }}
                        </span>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>

            <!-- Training Impact Legend -->
            <div *ngIf="tempTrainingType" class="mt-3">
              <small class="text-muted">
                <span class="badge bg-success me-2">Green</span>
                Attributes that will be improved by {{ tempTrainingType }}
              </small>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>